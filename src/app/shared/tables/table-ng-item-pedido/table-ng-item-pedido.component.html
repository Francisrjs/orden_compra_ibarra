<p-toast></p-toast>

<p-table 
[value]="items" dataKey="id" 
[tableStyle]="{ 'min-width': '40rem' }"
  [paginator]="true"
[rows]="10"
currentPageReportTemplate="mostrando {first} de {last} del total {totalRecords} entradas"
[rowsPerPageOptions]="[10,20,30]"
>
  <ng-template pTemplate="header">
    <tr>
  
       <th pSortableColumn="numero_pedido" style="width: 30rem">
        Numero Pedido <p-sortIcon field="numero_pedido"></p-sortIcon>
      </th>
      <th pSortableColumn="producto.nombre">
        Producto <p-sortIcon field="producto.nombre"></p-sortIcon>
      </th>
      <th pSortableColumn="cantidad" class="small-col">
        Cantidad <p-sortIcon field="cantidad"></p-sortIcon>
      </th>
      <th pSortableColumn="unidad_medida.nombre">
        Medida <p-sortIcon field="unidad_medida.nombre"></p-sortIcon>
      </th>
      <th pSortableColumn="estado" class="small-col">
        Estado <p-sortIcon field="estado"></p-sortIcon>
      </th>

      <th class="actions-col">Acción</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-item>
    <tr>
    
      <td style="width: 8rem">{{ getNumeroPedido(item) }}</td>
      <td>{{ item.producto?.nombre }}</td>
      <td>
        {{ (item.cantidad_aceptada ?? 0) > 0 ? item.cantidad_aceptada : item.cantidad }}
      </td>

      <!-- Un solo td para unidad: muestra la unidad aceptada si existe, sino la unidad original -->
      <td>
        {{ item.unidad_medida_aceptada?.nombre ?? item.unidad_medida?.nombre }}
      </td>

      <td>
        <p-tag
          [value]="item.estado | uppercase"
          [severity]="getStatusSeverity(item.estado)"
        ></p-tag>
      </td>

      <!-- Si quieres mostrar un input o icono para cambiar cantidad aceptada, aquí -->

      <!-- Botón PLUS que emite el item -->
      <td class="actions-col d-flex">
        <!-- <button
          pButton
          type="button"
          icon="pi pi-plus"
          class="p-button-rounded p-button-success"
         
          title="Agregar / seleccionar"
        ></button> -->
        <p-button
          icon="pi pi-plus"
          (click)="onAdd(item)"
          styleClass="p-button-rounded p-button-outlined"
          [rounded]="true"
          [text]="true"
          severity="success"
        ></p-button>
           
        <p-button
              icon="pi pi-eye"
              [rounded]="true"
              [text]="true"
              severity="info"
              [routerLink]="['/pedido', getPedido_id(item)]"
            />
            
 
      </td> 
    </tr>
            <ng-template pTemplate="paginatorleft">
            <p-button type="button" icon="pi pi-plus" styleClass="p-button-text"></p-button>
        </ng-template>
        <ng-template pTemplate="paginatorright">
            <p-button type="button" icon="pi pi-cloud" styleClass="p-button-text"></p-button>
        </ng-template>
  </ng-template>

  <ng-template pTemplate="emptymessage">
    <tr>
      <td colspan="7">No hay items pendientes.</td>
    </tr>
  </ng-template>
</p-table>
