<p-toast></p-toast>

<p-table
  [value]="items"
  dataKey="id"
  [tableStyle]="{ 'min-width': '40rem' }"
  [paginator]="true"
  [rows]="10"
  currentPageReportTemplate="mostrando {first} de {last} del total {totalRecords} entradas"
  [rowsPerPageOptions]="[10, 20, 30]"
  [scrollable]="true"
  scrollDirection="horizontal"
  frozenWidth="120px"
>
  <ng-template pTemplate="header">
    <tr>
      <th
        pSortableColumn="numero_pedido"
        style="width: 5rem"
        class="text-center"
      >
        Numero Pedido <p-sortIcon field="numero_pedido"></p-sortIcon>
      </th>
      <th
        pSortableColumn="producto.nombre"
        style="width: 20rem"
        class="text-center"
      >
        Producto <p-sortIcon field="producto.nombre"></p-sortIcon>
      </th>
      <th pSortableColumn="cantidad" class="small-col text-center">
        Cantidad <p-sortIcon field="cantidad"></p-sortIcon>
      </th>
      <th pSortableColumn="unidad_medida.nombre" class="text-center">
        Medida <p-sortIcon field="unidad_medida.nombre"></p-sortIcon>
      </th>
      <th pSortableColumn="estado" class="small-col text-center">
        Estado <p-sortIcon field="estado"></p-sortIcon>
      </th>

      <th
        class="actions-col text-center"
        alignFrozen="right"
        pFrozenColumn
        [frozen]="balanceFrozen"
      >
        Acción
      </th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-item>
    <tr>
      <td style="width: 8rem" class="text-center">
        {{ getNumeroPedido(item) }}
      </td>
      <td class="text-center">{{ item.producto?.nombre }}</td>
      <td class="text-center">
        {{
          (item.cantidad_aceptada ?? 0) > 0
            ? item.cantidad_aceptada
            : item.cantidad
        }}
      </td>

      <!-- Un solo td para unidad: muestra la unidad aceptada si existe, sino la unidad original -->
      <td class="text-center">
        {{ item.unidad_medida_aceptada?.nombre ?? item.unidad_medida?.nombre }}
      </td>

      <td class="text-center">
        <p-tag
          [value]="item.estado | uppercase"
          [severity]="getStatusSeverity(item.estado)"
        ></p-tag>
      </td>

      <!-- Si quieres mostrar un input o icono para cambiar cantidad aceptada, aquí -->

      <!-- Botón PLUS que emite el item -->
      <td
        class="actions-col d-flex justify-content-center"
        alignFrozen="right"
        pFrozenColumn
        [frozen]="balanceFrozen"
      >
        <p-button
          icon="pi pi-plus"
          (click)="onAdd(item)"
          styleClass="p-button-rounded p-button-outlined"
          [rounded]="true"
          [text]="true"
          severity="success"
        ></p-button>

        <p-button
          icon="pi pi-eye"
          [rounded]="true"
          [text]="true"
          severity="info"
          [routerLink]="['/pedido', getPedido_id(item)]"
        />
      </td>
    </tr>
    <ng-template pTemplate="paginatorleft">
      <p-button
        type="button"
        icon="pi pi-plus"
        styleClass="p-button-text"
      ></p-button>
    </ng-template>
    <ng-template pTemplate="paginatorright">
      <p-button
        type="button"
        icon="pi pi-cloud"
        styleClass="p-button-text"
      ></p-button>
    </ng-template>
  </ng-template>

  <ng-template pTemplate="emptymessage">
    <tr>
      <td colspan="7" class="text-center">No hay items pendientes.</td>
    </tr>
  </ng-template>
</p-table>
